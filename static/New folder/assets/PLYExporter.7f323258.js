import{m as G,V as X,o as Y}from"./index.ff11555b.js";class V{parse(T,v,r){v&&typeof v=="object"&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=v,v=void 0);function z(a){T.traverse(function(d){if(d.isMesh===!0){const f=d,e=f.geometry;if(e.isBufferGeometry!==!0)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");e.hasAttribute("position")===!0&&a(f,e)}})}r=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},r);const F=r.excludeAttributes;let y=!1,g=!1,h=!1,O=0,w=0;T.traverse(function(a){if(a.isMesh===!0){const f=a.geometry;if(f.isBufferGeometry!==!0)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");const e=f.getAttribute("position"),t=f.getAttribute("normal"),n=f.getAttribute("uv"),u=f.getAttribute("color"),x=f.getIndex();if(e===void 0)return;O+=e.count,w+=x?x.count/3:e.count/3,t!==void 0&&(y=!0),n!==void 0&&(h=!0),u!==void 0&&(g=!0)}});const E=new G,M=F.indexOf("index")===-1;if(y=y&&F.indexOf("normal")===-1,g=g&&F.indexOf("color")===-1,h=h&&F.indexOf("uv")===-1,M&&w!==Math.floor(w))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;const p=4;let A=`ply
format ${r.binary?r.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0
element vertex ${O}
property float x
property float y
property float z
`;y===!0&&(A+=`property float nx
property float ny
property float nz
`),h===!0&&(A+=`property float s
property float t
`),g===!0&&(A+=`property uchar red
property uchar green
property uchar blue
`),M===!0&&(A+=`element face ${w}
property list uchar int vertex_index
`),A+=`end_header
`;const l=new X,L=new Y;let $=null;if(r.binary===!0){const a=new TextEncoder().encode(A),d=O*(4*3+(y?4*3:0)+(g?3:0)+(h?4*2:0)),f=M?w*(p*3+1):0,e=new DataView(new ArrayBuffer(a.length+d+f));new Uint8Array(e.buffer).set(a,0);let t=a.length,n=a.length+d,u=0;z(function(x,b){const s=b.getAttribute("position"),i=b.getAttribute("normal"),m=b.getAttribute("uv"),c=b.getAttribute("color"),U=b.getIndex();L.getNormalMatrix(x.matrixWorld);for(let o=0,B=s.count;o<B;o++)l.fromBufferAttribute(s,o),l.applyMatrix4(x.matrixWorld),e.setFloat32(t,l.x,r.littleEndian),t+=4,e.setFloat32(t,l.y,r.littleEndian),t+=4,e.setFloat32(t,l.z,r.littleEndian),t+=4,y===!0&&(i!=null?(l.fromBufferAttribute(i,o),l.applyMatrix3(L).normalize(),e.setFloat32(t,l.x,r.littleEndian),t+=4,e.setFloat32(t,l.y,r.littleEndian),t+=4,e.setFloat32(t,l.z,r.littleEndian),t+=4):(e.setFloat32(t,0,r.littleEndian),t+=4,e.setFloat32(t,0,r.littleEndian),t+=4,e.setFloat32(t,0,r.littleEndian),t+=4)),h===!0&&(m!=null?(e.setFloat32(t,m.getX(o),r.littleEndian),t+=4,e.setFloat32(t,m.getY(o),r.littleEndian),t+=4):(e.setFloat32(t,0,r.littleEndian),t+=4,e.setFloat32(t,0,r.littleEndian),t+=4)),g===!0&&(c!=null?(E.fromBufferAttribute(c,o).convertLinearToSRGB(),e.setUint8(t,Math.floor(E.r*255)),t+=1,e.setUint8(t,Math.floor(E.g*255)),t+=1,e.setUint8(t,Math.floor(E.b*255)),t+=1):(e.setUint8(t,255),t+=1,e.setUint8(t,255),t+=1,e.setUint8(t,255),t+=1));if(M===!0)if(U!==null)for(let o=0,B=U.count;o<B;o+=3)e.setUint8(n,3),n+=1,e.setUint32(n,U.getX(o+0)+u,r.littleEndian),n+=p,e.setUint32(n,U.getX(o+1)+u,r.littleEndian),n+=p,e.setUint32(n,U.getX(o+2)+u,r.littleEndian),n+=p;else for(let o=0,B=s.count;o<B;o+=3)e.setUint8(n,3),n+=1,e.setUint32(n,u+o,r.littleEndian),n+=p,e.setUint32(n,u+o+1,r.littleEndian),n+=p,e.setUint32(n,u+o+2,r.littleEndian),n+=p;u+=s.count}),$=e.buffer}else{let a=0,d="",f="";z(function(e,t){const n=t.getAttribute("position"),u=t.getAttribute("normal"),x=t.getAttribute("uv"),b=t.getAttribute("color"),s=t.getIndex();L.getNormalMatrix(e.matrixWorld);for(let i=0,m=n.count;i<m;i++){l.fromBufferAttribute(n,i),l.applyMatrix4(e.matrixWorld);let c=l.x+" "+l.y+" "+l.z;y===!0&&(u!=null?(l.fromBufferAttribute(u,i),l.applyMatrix3(L).normalize(),c+=" "+l.x+" "+l.y+" "+l.z):c+=" 0 0 0"),h===!0&&(x!=null?c+=" "+x.getX(i)+" "+x.getY(i):c+=" 0 0"),g===!0&&(b!=null?(E.fromBufferAttribute(b,i).convertLinearToSRGB(),c+=" "+Math.floor(E.r*255)+" "+Math.floor(E.g*255)+" "+Math.floor(E.b*255)):c+=" 255 255 255"),d+=c+`
`}if(M===!0){if(s!==null)for(let i=0,m=s.count;i<m;i+=3)f+=`3 ${s.getX(i+0)+a}`,f+=` ${s.getX(i+1)+a}`,f+=` ${s.getX(i+2)+a}
`;else for(let i=0,m=n.count;i<m;i+=3)f+=`3 ${a+i} ${a+i+1} ${a+i+2}
`;w+=s?s.count/3:n.count/3}a+=n.count}),$=`${A}${d}${M?`${f}
`:`
`}`}return typeof v=="function"&&requestAnimationFrame(()=>v($)),$}}export{V as PLYExporter};
