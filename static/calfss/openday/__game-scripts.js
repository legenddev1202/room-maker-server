pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #000000;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #000000;","}","","#application-splash {","    position: absolute;","    top: 50%;","    width: 400px;","    height: 200px;","    left: 50%;","    transform: translate(-50%, -50%);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #fff;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f23d2a;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 200px;","        left: calc(50% - 100px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://play.grwth.hk/icon.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var n=document.createElement("div");n.id="progress-bar-container",t.appendChild(n);var o=document.createElement("div");o.id="progress-bar",n.appendChild(o)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var Caption=pc.createScript("caption");Caption.attributes.add("type",{type:"number",description:"caption: 0, link: 1, popup: 2",default:0}),Caption.attributes.add("title",{type:"string"}),Caption.attributes.add("content",{type:"string"}),Caption.attributes.add("url",{type:"string"}),Caption.attributes.add("editToPlay",{type:"string"}),Caption.prototype.initialize=function(){},Caption.prototype.openCaption=function(){if(0===this.type)""===this.title&&""===this.content||this.app.fire("caption:open",this.title,this.content);else if(1===this.type){if(this.app.fire("vr:end"),console.log("caption vr:end"),this.editToPlay&&!this.url){const t=this.editToPlay.split("/");this.url=`https://play.grwth.io/play/?assignments=${t[4]}`}1==window.confirm(`Press Yes to Rediract to ${this.url}`)&&window.open(this.url,"_blank")}else 2===this.type&&""!==this.url&&this.app.fire("popup:open",this.url)};var VideoTextureLink=pc.createScript("videoTextureLink");VideoTextureLink.attributes.add("video",{type:"string"}),VideoTextureLink.attributes.add("screenMaterial",{type:"string"}),VideoTextureLink.attributes.add("screenMaterial2",{type:"asset",assetType:"material"}),VideoTextureLink.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",this.videoDom=t;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0,flipY:!0}),this.videoTexture.setSource(t),t.addEventListener("canplaythrough",function(i){console.log("video canplaythrough","this.screenMaterial2",this.screenMaterial2,"this.screenMaterial",this.screenMaterial),this.screenMaterial2?e.fire("tv:play",this.videoTexture,this.screenMaterial2):this.screenMaterial?e.fire("tv:play",this.videoTexture,this.screenMaterial):this.entity.model.meshInstances[0].material&&e.fire("tv:play",this.videoTexture,this.entity.model.meshInstances[0].material),t.play()}.bind(this)),t.src=this.video,document.body.appendChild(t),t.load()},VideoTextureLink.prototype.control=function(e){this.videoDom.paused?(this.videoDom.play(),this.app.fire("video:playing",e)):(this.videoDom.pause(),this.app.fire("video:paused",e))},VideoTextureLink.prototype.update=function(e){this.videoTexture.upload()};var TvScreen=pc.createScript("tvscreen");TvScreen.prototype.initialize=function(){this.app.on("tv:play",(function(e,i){if(console.log("tv:play",i.resource,i.diffuseMap),i.resource){var p=i.resource;p.diffuseMap=e,p.emissiveMap=e,p.update()}i.diffuseMap&&(i.diffuseMap=e,i.emissiveMap=e,i.update())}),this)};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0,a=0,n=null,s=[],r=t.findComponents("render");for(e=0;e<r.length;++e)for(n=r[e].meshInstances,a=0;a<n.length;a++)s.push(n[a]);var h=t.findComponents("model");for(e=0;e<h.length;++e)for(n=h[e].meshInstances,a=0;a<n.length;a++)s.push(n[a]);for(e=0;e<s.length;e++)0===i?this._modelsAabb.copy(s[e].aabb):this._modelsAabb.add(s[e].aabb),i+=1;return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var n=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,n),Math.atan2(n.y,-n.z)*pc.math.RAD_TO_DEG};var PickerFramebuffer=pc.createScript("pickerFramebuffer");PickerFramebuffer.attributes.add("pickAreaScale",{type:"number",title:"Pick Area Scale",description:"1 is more accurate but worse performance. 0.01 is best performance but least accurate. 0.25 is the default.",default:.25,min:.01,max:1}),PickerFramebuffer.attributes.add("layerNames",{type:"string",title:"Layers Names",array:!0,description:"Layer names from which objects will be picked from.",default:["World"]}),PickerFramebuffer.prototype.initialize=function(){var e=this.app.graphicsDevice.canvas,t=parseInt(e.clientWidth,10),i=parseInt(e.clientHeight,10);this.picker=new pc.Picker(this.app,t*this.pickAreaScale,i*this.pickAreaScale),this.layers=[];for(var r=0;r<this.layerNames.length;++r){var c=this.app.scene.layers.getLayerByName(this.layerNames[r]);c&&this.layers.push(c)}this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onSelect,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onSelect,this)}),this)},PickerFramebuffer.prototype.onSelect=function(e){var t=this.app.graphicsDevice.canvas,i=parseInt(t.clientWidth,10),r=parseInt(t.clientHeight,10),c=this.entity.camera.camera,a=this.app.scene,n=this.picker;n.resize(i*this.pickAreaScale,r*this.pickAreaScale),n.prepare(c,a,this.layers);var o=n.getSelection({x:Math.floor(e.x*(n.width/i)),y:n.height-Math.floor(e.y*(n.height/r))});if(o.length>0){var s=o[0].node;console.log("PickerFramebuffer:selected",s),s.children[0]&&s.children[0].script&&s.children[0].script.rmobjectEvent&&(console.log("PickerFramebuffer:selected",s,s.children[0].script),s.children[0].script.rmobjectEvent.checkEvent());let e=window.location.href;if(e.includes("1759851")||e.includes("1775785")||e.includes("openday")||e.includes("3bef05c7")){let e=s,t=!1,i=0;for(;e.parent&&!t&&i++<10;){if(e.name.includes("R_oom")){console.log("room",e.name,e.name===this.entity.script.orbitCamera.focusEntity.name,e.script.caption),this.entity.script.orbitCamera.focusEntity.name===e.name?e.script.caption&&(console.log("openCaption"),e.script.caption.openCaption()):this.entity.script.orbitCamera.focusEntity=e,t=!0;break}console.log("no room",e.name,e.parent.name),e=e.parent}t||(this.entity.script.orbitCamera.focusEntity=this.app.root.findByName("Zero")),console.log("PickerFramebuffer:selected: Camera Focus Entity ",this.entity.script.orbitCamera.focusEntity)}}},PickerFramebuffer.prototype.onSelectVR=function(e){console.log("onSelectVR",e);var t=new pc.Ray;t.set(this.inputSource.getOrigin(),this.inputSource.getDirection()),this.app.root.findByName("Environment").findByName("RoomMaker").children[0].children.forEach((e=>{let i=e.getLocalScale().clone().scale(.75);new pc.BoundingBox(e.getPosition().clone(),i).intersectsRay(t)&&e.children[0]&&e.children[0].script&&e.children[0].script.rmobjectEvent&&(console.log("PickerFramebuffer:selectVR",e,e.children[0].script),e.children[0].script.rmobjectEvent.checkEvent())}))};